<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Master Quiz Level 7</title>
	<link rel="stylesheet" href="../../assets/css/style.css">
	<style>
		.buzzer-effect {
			position: fixed;
			top: 0; left: 0; right: 0; bottom: 0;
			background: rgba(255, 59, 59, 0.25);
			pointer-events: none;
			z-index: 9999;
			animation: screenBuzz 0.4s linear 1;
		}
		@keyframes screenBuzz {
			0% { transform: translateX(0); }
			20% { transform: translateX(-16px); }
			40% { transform: translateX(16px); }
			60% { transform: translateX(-16px); }
			80% { transform: translateX(16px); }
			100% { transform: translateX(0); }
		}
		.duo-header {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 18px;
			margin-top: 32px;
			margin-bottom: 18px;
		}
		.duo-img {
			width: 64px;
			height: 64px;
			border-radius: 50%;
			background: #fff;
			box-shadow: 0 2px 8px #1e3c72;
		}
		.duo-title {
			font-size: 2.2rem;
			font-weight: 700;
			color: #4a90e2;
			font-family: 'Segoe UI', Arial, sans-serif;
			text-shadow: 0 2px 8px #222;
		}
		.quiz-progress {
			margin: 18px auto 0 auto;
			width: 80%;
			height: 18px;
			background: #232946;
			border-radius: 12px;
			overflow: hidden;
		}
		.quiz-progress-bar {
			height: 100%;
			background: linear-gradient(90deg, #4a90e2, #7f9cf5);
			width: 0%;
			border-radius: 12px;
			transition: width 0.3s;
		}
		.quiz-question {
			font-size: 2rem;
			font-weight: 700;
			margin: 96px 0 32px 0;
            margin-bottom: 130px;
			color: #f7f7fa;
			text-align: center;
		}
		.quiz-answers {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 32px;
			margin-bottom: 32px;
			margin-top: 48px;
			width: calc(100vw - 80px);
			max-width: calc(100vw - 80px);
			padding-left: 40px;
			padding-right: 40px;
		}
		.answer-btn-custom {
			width: 100%;
			min-width: 0;
			border-radius: 0;
			font-size: 1.5rem;
			padding: 48px 0;
			margin: 0;
			box-sizing: border-box;
			background: #232946;
			color: #f7f7fa;
			font-weight: 600;
			border-width: 4px;
			border-style: solid;
			transition: box-shadow 0.2s, transform 0.1s, border-color 0.2s;
			box-shadow: 0 4px 16px #23294655;
			min-height: 64px;
			position: relative;
			overflow: hidden;
		}
		.answer-btn-custom:hover {
			transform: scale(1.04);
			box-shadow: 0 8px 32px #23294699;
			opacity: 0.97;
		}
		.answer-fill {
			position: absolute;
			left: 0; bottom: 0;
			width: 100%;
			height: 0%;
			z-index: 1;
			transition: height 0.8s cubic-bezier(.4,1.6,.4,1);
		}
		.answer-btn-custom .answer-fill {
			border-radius: 0;
		}
		.answer-fill.c1 { background: linear-gradient(0deg, #e57373 80%, #ffb3b3 100%); }
		.answer-fill.c2 { background: linear-gradient(0deg, #64b5f6 80%, #b3e0ff 100%); }
		.answer-fill.c3 { background: linear-gradient(0deg, #81c784 80%, #c8e6c9 100%); }
		.answer-fill.c4 { background: linear-gradient(0deg, #ffd54f 80%, #fff9c4 100%); }
		.border-c1 { border-color: #e57373; }
		.border-c2 { border-color: #64b5f6; }
		.border-c3 { border-color: #81c784; }
		.border-c4 { border-color: #ffd54f; }
		.quiz-feedback {
			font-size: 1.1rem;
			font-weight: 500;
			color: #ffeb3b;
			margin-bottom: 12px;
			min-height: 24px;
			transition: color 0.2s;
		}
		.quiz-feedback.wrong {
			color: #ff3b3b;
			animation: buzz 0.3s linear 1;
		}
		@keyframes buzz {
			0% { transform: translateX(0); }
			20% { transform: translateX(-8px); }
			40% { transform: translateX(8px); }
			60% { transform: translateX(-8px); }
			80% { transform: translateX(8px); }
			100% { transform: translateX(0); }
		}
		.quiz-finish {
			font-size: 1.5rem;
			color: #4a90e2;
			font-weight: 700;
			margin-top: 24px;
		}
	</style>
</head>
<body style="margin:0; padding:0; overflow-x:hidden; background:#232946;">
	<button id="pause-btn" style="position:fixed;top:24px;left:32px;z-index:1000;padding:12px 24px;font-size:1.4rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">&#124; &#124;</button>
	<div id="pause-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(30,30,50,0.85);z-index:2000;align-items:center;justify-content:center;">
		<div style="background:#fff;border-radius:18px;padding:40px 32px;box-shadow:0 8px 32px #23294699;min-width:280px;max-width:90vw;text-align:center;">
			<h2 style="color:#4a90e2;margin-bottom:24px;">Game Paused</h2>
			<button id="resume-btn" style="margin:12px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Resume</button><br>
			<button id="restart-btn" style="margin:18px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#ffd54f;color:#232946;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Restart</button><br>
			<button id="exit-btn" style="margin:18px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#e57373;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Exit</button>
		</div>
	</div>
	<div class="duo-header">
		<img src="Panda.png" alt="DuoLingo Panda" class="duo-img">
		<span class="duo-title">Master Quiz 7: Pro Masters</span>
	</div>
	<div class="quiz-progress">
		<div class="quiz-progress-bar" id="quiz-progress-bar"></div>
	</div>
	<div class="quiz-question" id="quiz-question"></div>
	<div class="quiz-feedback" id="quiz-feedback"></div>
	<div class="quiz-answers" id="quiz-answers"></div>
	<div id="buzzer-effect-root"></div>
	<script>
	// Pause modal logic
	let paused = false;
	const pauseBtn = document.getElementById('pause-btn');
	const pauseModal = document.getElementById('pause-modal');
	const resumeBtn = document.getElementById('resume-btn');
	const restartBtn = document.getElementById('restart-btn');
	const exitBtn = document.getElementById('exit-btn');

	pauseBtn.onclick = function() {
		paused = true;
		pauseModal.style.display = 'flex';
	};
	resumeBtn.onclick = function() {
		paused = false;
		pauseModal.style.display = 'none';
	};
	restartBtn.onclick = function() {
		paused = false;
		pauseModal.style.display = 'none';
		current = 0;
		score = 0;
		// Re-shuffle questions for a fresh start
		for (let i = 0; i < questions.length; i++) questions[i] = originalQuestions[i];
		shuffleArray(questions);
		showQuestion();
		document.getElementById('quiz-progress-bar').style.width = '0%';
	};
	exitBtn.onclick = function() {
		   window.location.href = 'master.html';
	   };
	// Duolingo-style quiz logic
	function shuffleArray(arr) {
		for (let i = arr.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[arr[i], arr[j]] = [arr[j], arr[i]];
		}
		return arr;
	}

	const originalQuestions = [
    {
        q: 'Translate into English:<br>æ— è®ºç»“æœå¦‚ä½•ï¼Œä»–éƒ½ä¸ä¼šæ”¾å¼ƒã€?,
        options: [
            'No matter the result, he will not give up.',
            'He will give up if he fails.',
            'He only cares about the result.',
            'He is not interested in the result.'
        ],
        answer: 0
    },
    {
        q: 'Which sentence uses â€œä»¥å…â€?correctly?',
        options: [
            'ä»–å¸¦äº†é›¨ä¼ï¼Œä»¥å…ä¸‹é›¨çš„æ—¶å€™æ·‹æ¹¿ã€?,
            'ä»–å¸¦äº†é›¨ä¼ï¼Œä»¥å…å¤©æ°”å¾ˆå¥½ã€?,
            'ä»–å¸¦äº†é›¨ä¼ï¼Œä»¥å…ä»–å–œæ¬¢æ•£æ­¥ã€?,
            'ä»–å¸¦äº†é›¨ä¼ï¼Œä»¥å…å»æ—…æ¸¸ã€?
        ],
        answer: 0
    },
    {
        q: 'Fill in with the correct connector:<br>ä»–ä¸ä»…èªæ˜ï¼Œ___å¾ˆå‹¤å¥‹ã€?,
        options: [
            'è€Œä¸”',
            'ä½†æ˜¯',
            'æ‰€ä»?,
            'å¦‚æœ'
        ],
        answer: 0
    },
    {
        q: 'Translate into Chinese:<br>â€œShe studies hard in order to achieve her dreamã€‚â€?,
        options: [
            'å¥¹åŠªåŠ›å­¦ä¹ ï¼Œä¸ºäº†å®ç°å¥¹çš„æ¢¦æƒ³ã€?,
            'å¥¹åŠªåŠ›å­¦ä¹ ï¼Œå› ä¸ºå¥¹å–œæ¬¢ç©ã€?,
            'å¥¹ä¸å–œæ¬¢å­¦ä¹ ã€?,
            'å¥¹å·²ç»å®ç°äº†æ¢¦æƒ³ã€?
        ],
        answer: 0
    },
    {
        q: 'Which word best fits?<br>ä»–çš„è®²è¯å¾ˆæœ‰___ï¼Œå¤§å®¶éƒ½è®¤çœŸå¬ã€?,
        options: [
            'æ„Ÿæƒ…',
            'é­…åŠ›',
            'è¡¨æƒ…',
            'è¡¨æ¼”'
        ],
        answer: 1
    },
    {
        q: 'Write the pinyin:<br>è‰°éš¾',
        options: [
            'jiÄnnÃ¡n',
            'jiÄngnÃ¡n',
            'jiÄnnÄn',
            'jiÄngnÄn'
        ],
        answer: 0
    },
    {
        q: 'Translate into English:<br>ä»–æŠ±æ€¨è¯´ç”Ÿæ´»å¤ªè¾›è‹¦äº†ã€?,
        options: [
            'He complained that life was too hard.',
            'He said life was very happy.',
            'He enjoys a comfortable life.',
            'He never complains about life.'
        ],
        answer: 0
    },
    {
        q: 'Choose the correct synonym for â€œé€æ¸â€?',
        options: [
            'çªç„¶',
            'æ¸æ¸',
            'é©¬ä¸Š',
            'ç«‹åˆ»'
        ],
        answer: 1
    },
    {
        q: 'Fill in:<br>ä»–___äº†å¾ˆå¤§çš„åŠªåŠ›ï¼Œç»ˆäºè€ƒä¸Šäº†å¤§å­¦ã€?,
        options: [
            'ç»?,
            'å?,
            'ä»˜å‡º',
            'å‡ºç°'
        ],
        answer: 2
    },
    {
        q: 'Translate into Chinese:<br>â€œCultural exchange helps us understand each other betterã€‚â€?,
        options: [
            'æ–‡åŒ–äº¤æµæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ç›¸äº’ç†è§£ã€?,
            'æ–‡åŒ–äº¤æµè®©æˆ‘ä»¬å˜å¾—å¯Œæœ‰ã€?,
            'æ–‡åŒ–äº¤æµè®©æˆ‘ä»¬å­¦ä¹ å¤–è¯­ã€?,
            'æ–‡åŒ–äº¤æµè®©æˆ‘ä»¬å–œæ¬¢æ—…æ¸¸ã€?
        ],
        answer: 0
    },
    {
        q: 'Which idiom means â€œdonâ€™t give up halfwayâ€?',
        options: [
            'åŠé€”è€ŒåºŸ',
            'ä¸€è§é’Ÿæƒ?,
            'è‡ªç›¸çŸ›ç›¾',
            'äº•åº•ä¹‹è›™'
        ],
        answer: 0
    },
    {
        q: 'Rearrange into a correct sentence:<br>æˆ‘ä»¬ / å°Šé‡ / åº”è¯¥ / ä¸åŒ / çš?/ æ–‡åŒ–',
        options: [
            'æˆ‘ä»¬åº”è¯¥å°Šé‡ä¸åŒçš„æ–‡åŒ?,
            'æˆ‘ä»¬å°Šé‡åº”è¯¥ä¸åŒçš„æ–‡åŒ?,
            'ä¸åŒçš„æ–‡åŒ–æˆ‘ä»¬åº”è¯¥å°Šé‡?,
            'åº”è¯¥æˆ‘ä»¬å°Šé‡ä¸åŒçš„æ–‡åŒ?
        ],
        answer: 0
    },
    {
        q: 'Translate into English:<br>ç§‘å­¦æŠ€æœ¯çš„å‘å±•æ”¹å˜äº†æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼ã€?,
        options: [
            'The development of science and technology has changed our way of life.',
            'Science and technology have no effect on our lives.',
            'Our way of life has not changed.',
            'Science and technology make life more difficult.'
        ],
        answer: 0
    },
    {
        q: 'Fill in:<br>ä»–åœ¨æ¼”è®²ä¸­è¡¨ç°å¾—å¾ˆ___ã€?confident)',
        options: [
            'è‡ªä¿¡',
            'ç´§å¼ ',
            'å®³ç¾',
            'æ¿€åŠ?
        ],
        answer: 0
    },
    {
        q: 'Short Writing (6â€? sentences):<br>Write about a time when you faced a difficult challenge and how you overcame it, in Chinese.',
        options: [
            'Open-ended',
            'Open-ended',
            'Open-ended',
            'Open-ended'
        ],
        answer: 0
    }
];

	// Shuffle questions at the start
	const questions = shuffleArray([...originalQuestions]);

	let current = 0;
	let score = 0;

	function showQuestion() {
		const q = questions[current];
		const questionDiv = document.getElementById('quiz-question');
		const answersDiv = document.getElementById('quiz-answers');
		questionDiv.innerHTML = q.q;
		answersDiv.innerHTML = '';

		// Shuffle options and track correct answer
		const optionObjs = q.options.map((opt, i) => ({ text: opt, origIdx: i }));
		const shuffledOptions = shuffleArray(optionObjs);
		// Find new correct answer index
		const newAnswerIdx = shuffledOptions.findIndex(optObj => optObj.origIdx === q.answer);
		// Store for checkAnswer
		q._shuffledOptions = shuffledOptions;
		q._shuffledAnswerIdx = newAnswerIdx;

		shuffledOptions.forEach((optObj, i) => {
			const btn = document.createElement('button');
			btn.className = `answer-btn-custom border-c${i + 1}`;
			btn.textContent = optObj.text;
			btn.onclick = () => checkAnswer(i);
			// Add fill div
			const fill = document.createElement('div');
			fill.className = `answer-fill c${i + 1}`;
			btn.appendChild(fill);
			answersDiv.appendChild(btn);
		});
		document.getElementById('quiz-feedback').textContent = '';
		updateProgress();
	}

	function checkAnswer(idx) {
		if (paused) return;
		const q = questions[current];
		let correct = false;
		if(idx === q._shuffledAnswerIdx) {
			correct = true;
			score++;
			document.getElementById('quiz-feedback').innerHTML = '<span style="color:#ffe600;font-weight:700;font-size:1.5rem;display:inline-block;text-align:center;width:100%">Correct! <span style="font-size:1.5rem;">ğŸ‰</span></span>';
			// Water fill animation
			const answersDiv = document.getElementById('quiz-answers');
			const btns = answersDiv.querySelectorAll('.answer-btn-custom');
			const btn = btns[idx];
			const fill = btn.querySelector('.answer-fill');
			fill.style.height = '100%';
			// Disable all buttons during animation
			btns.forEach(b => b.disabled = true);
			// Wait for animation to finish, then next question
			setTimeout(() => {
				if (!paused) nextQuestion();
			}, 850);
		} else {
			const feedback = document.getElementById('quiz-feedback');
			feedback.innerHTML = '<span style="color:#ff3b3b;font-weight:700;font-size:1.5rem;display:inline-block;text-align:center;width:100%">Oops! Try again.</span>';
			feedback.classList.add('wrong');
			// Show full-screen buzzer effect
			const buzzerRoot = document.getElementById('buzzer-effect-root');
			const buzzerDiv = document.createElement('div');
			buzzerDiv.className = 'buzzer-effect';
			buzzerRoot.appendChild(buzzerDiv);
			setTimeout(() => {
				feedback.classList.remove('wrong');
				feedback.textContent = '';
				buzzerDiv.remove();
			}, 700);
		}
	}

	function nextQuestion() {
		current++;
		if(current < questions.length) {
			showQuestion();
		} else {
			finishQuiz();
		}
	}

	function updateProgress() {
		const bar = document.getElementById('quiz-progress-bar');
		bar.style.width = ((current / questions.length) * 100) + '%';
	}

	function setUnlockedLevel(level) {
		localStorage.setItem('rookieUnlockedLevel', String(level));
		// If logged in, update backend
		var username = localStorage.getItem('rookieUserId');
		if (username) {
			fetch('http://localhost:3000/api/updateProgress', {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify({ username, unlockedLevel: level })
			});
		}
	}

	function finishQuiz() {
		document.getElementById('quiz-question').innerHTML = '';
		document.getElementById('quiz-answers').innerHTML = '';
		document.getElementById('quiz-feedback').innerHTML = `<div class='quiz-finish'>Quiz Complete!<br>Your score: ${score} / ${questions.length}<br><br>ğŸ¼ Panda is proud of you!<br><button id='nextLevelBtn' style='margin-top:18px;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;'>Next Level</button></div>`;
		document.getElementById('quiz-progress-bar').style.width = '100%';
		setUnlockedLevel(2);
		setTimeout(function() {
			var btn = document.getElementById('nextLevelBtn');
			if (btn) {
				btn.onclick = function() {
					window.location.href = 'master_quiz8.html';
				};
			}
		}, 100);
	}

	showQuestion();
	</script>
</body>
</html>
