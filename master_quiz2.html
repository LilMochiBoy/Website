<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Rookie Quiz Level 1</title>
	<link rel="stylesheet" href="style.css">
	<style>
		.buzzer-effect {
			position: fixed;
			top: 0; left: 0; right: 0; bottom: 0;
			background: rgba(255, 59, 59, 0.25);
			pointer-events: none;
			z-index: 9999;
			animation: screenBuzz 0.4s linear 1;
		}
		@keyframes screenBuzz {
			0% { transform: translateX(0); }
			20% { transform: translateX(-16px); }
			40% { transform: translateX(16px); }
			60% { transform: translateX(-16px); }
			80% { transform: translateX(16px); }
			100% { transform: translateX(0); }
		}
		.duo-header {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 18px;
			margin-top: 32px;
			margin-bottom: 18px;
		}
		.duo-img {
			width: 64px;
			height: 64px;
			border-radius: 50%;
			background: #fff;
			box-shadow: 0 2px 8px #1e3c72;
		}
		.duo-title {
			font-size: 2.2rem;
			font-weight: 700;
			color: #4a90e2;
			font-family: 'Segoe UI', Arial, sans-serif;
			text-shadow: 0 2px 8px #222;
		}
		.quiz-progress {
			margin: 18px auto 0 auto;
			width: 80%;
			height: 18px;
			background: #232946;
			border-radius: 12px;
			overflow: hidden;
		}
		.quiz-progress-bar {
			height: 100%;
			background: linear-gradient(90deg, #4a90e2, #7f9cf5);
			width: 0%;
			border-radius: 12px;
			transition: width 0.3s;
		}
		.quiz-question {
			font-size: 2rem;
			font-weight: 700;
			margin: 96px 0 16px 0;   /* Reduced bottom margin for closer spacing */
			color: #f7f7fa;
			text-align: center;
		}
		.quiz-answers {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 32px;
			margin-bottom: 32px;
			margin-top: 50px;         /* Reduced top margin for closer spacing */
			width: calc(100vw - 80px);
			max-width: calc(100vw - 80px);
			padding-left: 40px;
			padding-right: 40px;
		}
		.answer-btn-custom {
			width: 100%;
			min-width: 0;
			border-radius: 0;
			font-size: 1.5rem;
			padding: 48px 0;
			margin: 0;
			box-sizing: border-box;
			background: #232946;
			color: #f7f7fa;
			font-weight: 600;
			border-width: 4px;
			border-style: solid;
			transition: box-shadow 0.2s, transform 0.1s, border-color 0.2s;
			box-shadow: 0 4px 16px #23294655;
			min-height: 64px;
			position: relative;
			overflow: hidden;
		}
		.answer-btn-custom:hover {
			transform: scale(1.04);
			box-shadow: 0 8px 32px #23294699;
			opacity: 0.97;
		}
		.answer-fill {
			position: absolute;
			left: 0; bottom: 0;
			width: 100%;
			height: 0%;
			z-index: 1;
			transition: height 0.8s cubic-bezier(.4,1.6,.4,1);
		}
		.answer-btn-custom .answer-fill {
			border-radius: 0;
		}
		.answer-fill.c1 { background: linear-gradient(0deg, #e57373 80%, #ffb3b3 100%); }
		.answer-fill.c2 { background: linear-gradient(0deg, #64b5f6 80%, #b3e0ff 100%); }
		.answer-fill.c3 { background: linear-gradient(0deg, #81c784 80%, #c8e6c9 100%); }
		.answer-fill.c4 { background: linear-gradient(0deg, #ffd54f 80%, #fff9c4 100%); }
		.border-c1 { border-color: #e57373; }
		.border-c2 { border-color: #64b5f6; }
		.border-c3 { border-color: #81c784; }
		.border-c4 { border-color: #ffd54f; }
		.quiz-feedback {
			font-size: 1.1rem;
			font-weight: 500;
			color: #ffeb3b;
			margin-bottom: 12px;
			min-height: 24px;
			transition: color 0.2s;
		}
		.quiz-feedback.wrong {
			color: #ff3b3b;
			animation: buzz 0.3s linear 1;
		}
		@keyframes buzz {
			0% { transform: translateX(0); }
			20% { transform: translateX(-8px); }
			40% { transform: translateX(8px); }
			60% { transform: translateX(-8px); }
			80% { transform: translateX(8px); }
			100% { transform: translateX(0); }
		}
		.quiz-finish {
			font-size: 1.5rem;
			color: #4a90e2;
			font-weight: 700;
			margin-top: 24px;
		}
	</style>
</head>
<body style="margin:0; padding:0; overflow-x:hidden; background:#232946;">
	<button id="pause-btn" style="position:fixed;top:24px;left:32px;z-index:1000;padding:12px 24px;font-size:1.4rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">&#124; &#124;</button>
	<div id="pause-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(30,30,50,0.85);z-index:2000;align-items:center;justify-content:center;">
		<div style="background:#fff;border-radius:18px;padding:40px 32px;box-shadow:0 8px 32px #23294699;min-width:280px;max-width:90vw;text-align:center;">
			<h2 style="color:#4a90e2;margin-bottom:24px;">Game Paused</h2>
			<button id="resume-btn" style="margin:12px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Resume</button><br>
			<button id="restart-btn" style="margin:18px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#ffd54f;color:#232946;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Restart</button><br>
			<button id="exit-btn" style="margin:18px 0 0 0;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#e57373;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;">Exit</button>
		</div>
	</div>
	<div class="duo-header">
		<img src="Panda.png" alt="DuoLingo Panda" class="duo-img">
		<span class="duo-title">Rookie Quiz 1: First Steps</span>
	</div>
	<div class="quiz-progress">
		<div class="quiz-progress-bar" id="quiz-progress-bar"></div>
	</div>
	<div class="quiz-question" id="quiz-question"></div>
	<div class="quiz-feedback" id="quiz-feedback"></div>
	<div class="quiz-answers" id="quiz-answers"></div>
	<div id="buzzer-effect-root"></div>
	<script>
	// Pause modal logic
	let paused = false;
	const pauseBtn = document.getElementById('pause-btn');
	const pauseModal = document.getElementById('pause-modal');
	const resumeBtn = document.getElementById('resume-btn');
	const restartBtn = document.getElementById('restart-btn');
	const exitBtn = document.getElementById('exit-btn');

	pauseBtn.onclick = function() {
		paused = true;
		pauseModal.style.display = 'flex';
	};
	resumeBtn.onclick = function() {
		paused = false;
		pauseModal.style.display = 'none';
	};
	restartBtn.onclick = function() {
		paused = false;
		pauseModal.style.display = 'none';
		current = 0;
		score = 0;
		// Re-shuffle questions for a fresh start
		for (let i = 0; i < questions.length; i++) questions[i] = originalQuestions[i];
		shuffleArray(questions);
		showQuestion();
		document.getElementById('quiz-progress-bar').style.width = '0%';
	};
	exitBtn.onclick = function() {
		window.location.href = 'master.html';
	};
	// Duolingo-style quiz logic
	function shuffleArray(arr) {
		for (let i = arr.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[arr[i], arr[j]] = [arr[j], arr[i]];
		}
		return arr;
	}

	const originalQuestions = [
		{
			q: 'Translate: ä»–ä¸ä½†èªæ˜ï¼Œè€Œä¸”éå¸¸å‹¤å¥‹ã€‚',
			options: [
				'He is not only smart but also very diligent.',
				'He is not only tall but also strong.',
				'He is not only rich but also generous.',
				'He is not only happy but also lucky.'
			],
			answer: 0
		},
		{
			q: 'Which idiom means â€œnot worth seeingâ€?',
			options: [
				'ä¸å€¼ä¸€æ',
				'ä¸å ªå…¥ç›®',
				'ä¸å¯æ€è®®',
				'ä¸å®¹å¿½è§†'
			],
			answer: 1
		},
		{
			q: 'Fill in: å¦‚æœæ˜å¤©ä¸‹é›¨ï¼Œæˆ‘ä»¬å°±___è®¡åˆ’ã€‚',
			options: [
				'å–æ¶ˆ',
				'åˆ é™¤',
				'ä¸¢å¼ƒ',
				'æ”¾å¼ƒ'
			],
			answer: 0
		},
		{
			q: 'Translate: â€œHe achieved success through hard work rather than luck.â€',
			options: [
				'ä»–æ˜¯é€šè¿‡åŠªåŠ›å·¥ä½œè€Œä¸æ˜¯é è¿æ°”å–å¾—æˆåŠŸçš„ã€‚',
				'ä»–é è¿æ°”å–å¾—äº†æˆåŠŸã€‚',
				'ä»–æ²¡æœ‰å–å¾—æˆåŠŸã€‚',
				'ä»–ä¸å–œæ¬¢åŠªåŠ›å·¥ä½œã€‚'
			],
			answer: 0
		},
		{
			q: 'Reading:<br>â€œè¿‘å¹´æ¥ï¼Œç¯å¢ƒé—®é¢˜æ—¥ç›Šä¸¥é‡ï¼Œç‰¹åˆ«æ˜¯ç©ºæ°”æ±¡æŸ“å’Œæ°´æ±¡æŸ“ï¼Œå·²ç»å½±å“åˆ°äººä»¬çš„ç”Ÿæ´»è´¨é‡ã€‚<br>ä¸ºäº†æ”¹å–„ç¯å¢ƒï¼Œå„å›½æ”¿åºœé‡‡å–äº†è®¸å¤šæªæ–½ã€‚â€<br><br><b>Question:</b> Which problems are mentioned?',
			options: [
				'Deforestation',
				'Air and water pollution',
				'Climate change',
				'Noise pollution'
			],
			answer: 1
		},
		{
			q: 'Translate: æˆ‘å·®ç‚¹å„¿å¿˜äº†å‘Šè¯‰ä½ ä¸€ä¸ªé‡è¦çš„æ¶ˆæ¯ã€‚',
			options: [
				'I almost forgot to tell you an important message.',
				'I forgot your name.',
				'I remembered everything.',
				'I told you everything.'
			],
			answer: 0
		},
		{
			q: 'Rearrange:<br>éœ€è¦ / æˆ‘ä»¬ / å…±åŒ / è§£å†³ / è¿™ä¸ªé—®é¢˜',
			options: [
				'æˆ‘ä»¬éœ€è¦å…±åŒè§£å†³è¿™ä¸ªé—®é¢˜',
				'å…±åŒéœ€è¦æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜',
				'æˆ‘ä»¬å…±åŒéœ€è¦è§£å†³è¿™ä¸ªé—®é¢˜',
				'è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦å…±åŒè§£å†³'
			],
			answer: 0
		},
		{
			q: 'Translate into Chinese:<br>â€œCultural exchange helps promote mutual understanding among people.â€',
			options: [
				'æ–‡åŒ–äº¤æµæœ‰åŠ©äºä¿ƒè¿›äººä»¬ä¹‹é—´çš„ç›¸äº’ç†è§£ã€‚',
				'æ–‡åŒ–äº¤æµè®©äººä»¬å˜å¾—å¯Œæœ‰ã€‚',
				'æ–‡åŒ–äº¤æµè®©äººä»¬å­¦ä¹ å¤–è¯­ã€‚',
				'æ–‡åŒ–äº¤æµè®©äººä»¬å–œæ¬¢æ—…æ¸¸ã€‚'
			],
			answer: 0
		},
		{
			q: 'Fill in: ä»–å¾ˆ___ï¼Œæ€»æ˜¯å…³å¿ƒåˆ«äººã€‚(kind)',
			options: [
				'å–„è‰¯',
				'ç¾ä¸½',
				'å¿«ä¹',
				'å¹²å‡€'
			],
			answer: 0
		},
		{
			q: 'Which idiom means â€œa blessing in disguiseâ€?',
			options: [
				'å¡ç¿å¤±é©¬',
				'ç”»è›‡æ·»è¶³',
				'èƒ¸æœ‰æˆç«¹',
				'è‰æœ¨çš†å…µ'
			],
			answer: 0
		},
		{
			q: 'Translate: ä»–ä¸€ç›´åŠªåŠ›å·¥ä½œï¼Œå¸Œæœ›èƒ½å¾—åˆ°å‡èŒã€‚',
			options: [
				'He has been working hard, hoping to get a promotion.',
				'He has been working hard, hoping to get a vacation.',
				'He has been working hard, hoping to get a car.',
				'He has been working hard, hoping to get a house.'
			],
			answer: 0
		},
		{
			q: 'Write pinyin: æŒ‘æˆ˜',
			options: [
				'tiÇozhÃ n',
				'tiÃ¡ozhÃ n',
				'tiÇozhÄn',
				'tiÃ¡ozhÄn'
			],
			answer: 0
		},
		{
			q: 'Translate into English:<br>æˆ‘ä»¬å¿…é¡»éµå®ˆè§„åˆ™ï¼Œä¸ç„¶ä¼šå—åˆ°æƒ©ç½šã€‚',
			options: [
				'We must follow the rules, otherwise we will be punished.',
				'We must break the rules, otherwise we will be punished.',
				'We must ignore the rules, otherwise we will be rewarded.',
				'We must write the rules, otherwise we will be punished.'
			],
			answer: 0
		},
		{
			q: 'Fill in: ä»–è®²è¯å¾ˆ___ï¼Œå¤§å®¶éƒ½å¬å¾—æ‡‚ã€‚ (clear)',
			options: [
				'æ¸…æ¥š',
				'æµåˆ©',
				'çƒ­é—¹',
				'å¹²å‡€'
			],
			answer: 0
		},
		{
			q: 'Short Writing: Write 5â€“6 sentences about an important tradition in your culture.',
			options: [
				'Open-ended',
				'Open-ended',
				'Open-ended',
				'Open-ended'
			],
			answer: 0
		}
	];

	// Shuffle questions at the start
	const questions = shuffleArray([...originalQuestions]);

	let current = 0;
	let score = 0;

	function showQuestion() {
		const q = questions[current];
		const questionDiv = document.getElementById('quiz-question');
		const answersDiv = document.getElementById('quiz-answers');
		questionDiv.innerHTML = q.q;
		answersDiv.innerHTML = '';

		// If open-ended, show a textarea
		if (q.options[0] === 'Open-ended') {
			const textarea = document.createElement('textarea');
			textarea.style.width = '100%';
			textarea.style.height = '120px';
			textarea.style.fontSize = '1.2rem';
			textarea.style.margin = '24px 0';
			textarea.placeholder = 'Type your answer here...';
			answersDiv.appendChild(textarea);

			const submitBtn = document.createElement('button');
			submitBtn.textContent = 'Submit';
			submitBtn.style.marginTop = '18px';
			submitBtn.style.padding = '10px 32px'; 
			submitBtn.style.fontSize = '1rem';     
			submitBtn.style.borderRadius = '8px';
			submitBtn.style.background = '#4a90e2';
			submitBtn.style.color = '#fff';
			submitBtn.style.border = 'none';
			submitBtn.style.boxShadow = '0 2px 8px #222';
			submitBtn.style.cursor = 'pointer';
			submitBtn.onclick = () => {
				document.getElementById('quiz-feedback').innerHTML = '<span style="color:#ffe600;font-weight:700;font-size:1.5rem;">Answer submitted!</span>';
				setTimeout(() => {
					nextQuestion();
				}, 900);
			};
			answersDiv.appendChild(submitBtn);
			document.getElementById('quiz-feedback').textContent = '';
			updateProgress();
			return;
		}

		// Shuffle options and track correct answer
		const optionObjs = q.options.map((opt, i) => ({ text: opt, origIdx: i }));
		const shuffledOptions = shuffleArray(optionObjs);
		// Find new correct answer index
		const newAnswerIdx = shuffledOptions.findIndex(optObj => optObj.origIdx === q.answer);
		// Store for checkAnswer
		q._shuffledOptions = shuffledOptions;
		q._shuffledAnswerIdx = newAnswerIdx;

		shuffledOptions.forEach((optObj, i) => {
			const btn = document.createElement('button');
			btn.className = `answer-btn-custom border-c${i + 1}`;
			btn.textContent = optObj.text;
			btn.onclick = () => checkAnswer(i);
			// Add fill div
			const fill = document.createElement('div');
			fill.className = `answer-fill c${i + 1}`;
			btn.appendChild(fill);
			answersDiv.appendChild(btn);
		});
		document.getElementById('quiz-feedback').textContent = '';
		updateProgress();
	}

	function checkAnswer(idx) {
		if (paused) return;
		const q = questions[current];
		let correct = false;
		if(q.options[0] === 'Open-ended') {
			nextQuestion();
			return;
		}
		if(idx === q._shuffledAnswerIdx) {
			correct = true;
			score++;
			document.getElementById('quiz-feedback').innerHTML = '<span style="color:#ffe600;font-weight:700;font-size:1.5rem;display:inline-block;text-align:center;width:100%">Correct! <span style="font-size:1.5rem;">ğŸ‰</span></span>';
			// Water fill animation
			const answersDiv = document.getElementById('quiz-answers');
			const btns = answersDiv.querySelectorAll('.answer-btn-custom');
			const btn = btns[idx];
			const fill = btn.querySelector('.answer-fill');
			fill.style.height = '100%';
			// Disable all buttons during animation
			btns.forEach(b => b.disabled = true);
			// Wait for animation to finish, then next question
			setTimeout(() => {
				if (!paused) nextQuestion();
			}, 850);
		} else {
			const feedback = document.getElementById('quiz-feedback');
			feedback.innerHTML = '<span style="color:#ff3b3b;font-weight:700;font-size:1.5rem;display:inline-block;text-align:center;width:100%">Oops! Try again.</span>';
			feedback.classList.add('wrong');
			// Show full-screen buzzer effect
			const buzzerRoot = document.getElementById('buzzer-effect-root');
			const buzzerDiv = document.createElement('div');
			buzzerDiv.className = 'buzzer-effect';
			buzzerRoot.appendChild(buzzerDiv);
			setTimeout(() => {
				feedback.classList.remove('wrong');
				feedback.textContent = '';
				buzzerDiv.remove();
			}, 700);
		}
	}

	function nextQuestion() {
		current++;
		if(current < questions.length) {
			showQuestion();
		} else {
			finishQuiz();
		}
	}

	function updateProgress() {
		const bar = document.getElementById('quiz-progress-bar');
		bar.style.width = ((current / questions.length) * 100) + '%';
	}

	function setUnlockedLevel(level) {
		localStorage.setItem('rookieUnlockedLevel', String(level));
		// If logged in, update backend
		var username = localStorage.getItem('rookieUserId');
		if (username) {
			fetch('http://localhost:3000/api/updateProgress', {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify({ username, unlockedLevel: level })
			});
		}
	}

	function finishQuiz() {
		document.getElementById('quiz-question').innerHTML = '';
		document.getElementById('quiz-answers').innerHTML = '';
		document.getElementById('quiz-feedback').innerHTML = `<div class='quiz-finish'>Quiz Complete!<br>Your score: ${score} / ${questions.length}<br><br>ğŸ¼ Panda is proud of you!<br><button id='nextLevelBtn' style='margin-top:18px;padding:12px 32px;font-size:1.1rem;border-radius:8px;background:#4a90e2;color:#fff;border:none;box-shadow:0 2px 8px #222;cursor:pointer;'>Next Level</button></div>`;
		document.getElementById('quiz-progress-bar').style.width = '100%';
		setUnlockedLevel(2);
		setTimeout(function() {
			var btn = document.getElementById('nextLevelBtn');
			if (btn) {
				btn.onclick = function() {
				 window.location.href = 'master_quiz2.html';
				};
			}
		}, 100);
	}

	showQuestion();
	</script>
</body>
</html>
